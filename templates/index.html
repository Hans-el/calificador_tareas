{% extends "base.html" %} {% block title %}Evaluador — Inicio{% endblock %} {%
block content %}
<div class="card shadow p-4 mx-auto" style="max-width: 700px">
  <h3 class="text-center my-2 mb-5">Evaluación Automática de Tareas</h3>
  <form
    id="form-evaluacion"
    action="/procesar"
    method="POST"
    enctype="multipart/form-data"
  >
    <!-- ================================ -->
    <!-- SUBIR ARCHIVO O TEXTO MANUAL -->
    <!-- ================================ -->
    <div class="mb-3">
      <label class="form-label fw-semibold">Seleccione un archivo</label>
      <input
        type="file"
        class="form-control"
        name="archivo"
        accept=".xlsx,.pdf,.docx"
      />
      <small class="text-muted">Formatos aceptados: Excel, PDF y Word</small>
    </div>
    <div class="mb-3">
      <label class="form-label fw-semibold">O ingrese texto manualmente</label>
      <textarea
        class="form-control"
        name="texto_manual"
        rows="4"
        placeholder="Ingrese el texto de la tarea aquí..."
      ></textarea>
    </div>
    <hr />
    <!-- ================================ -->
    <!-- CRITERIOS -->
    <!-- ================================ -->
    <label class="fw-bold mb-2">Criterios de Evaluación</label>
    <div id="contenedor-criterios"></div>
    <button
      type="button"
      class="btn btn-warning mt-2 fw-semibold"
      onclick="agregarCriterio()"
    >
      Agregar criterio
    </button>
    <hr />
    <button class="btn btn-success w-100 mt-3 fw-bold" type="submit">
      Evaluar Tarea
    </button>
  </form>
</div>

<script>
  // Lista de criterios predefinidos
  const criteriosDisponibles = [
    "Coherencia",
    "Claridad",
    "Ortografía",
    "Precisión",
    "Síntesis",
    "Relevancia",
    "Estructura",
    "Comprensión",
    "Originalidad",
    "Profundidad",
  ];

  // =====================================
  // Crear un bloque de criterio
  // =====================================
  function agregarCriterio() {
    const cont = document.getElementById("contenedor-criterios");
    let div = document.createElement("div");
    div.classList = "row mb-2 criterio-item";
    div.innerHTML = `
      <div class="col-5">
        <select name="criterio_nombre" class="form-select" required>
          <option value="" selected disabled>Seleccione un criterio</option>
          ${criteriosDisponibles
            .map((c) => `<option value="${c}">${c}</option>`)
            .join("")}
        </select>
      </div>
      <div class="col-5">
        <input type="number" class="form-control" name="criterio_peso"
               placeholder="Nota máxima (1-10)" min="1" max="10" required>
      </div>
      <div class="col-2 text-center">
        <button type="button" class="btn btn-danger btn-sm"
                onclick="this.parentNode.parentNode.remove();">
          X
        </button>
      </div>
    `;
    cont.appendChild(div);
  }

  // =====================================
  // Validar que al menos un criterio esté definido
  // =====================================
  document
    .getElementById("form-evaluacion")
    .addEventListener("submit", function (event) {
      const criterios = document.querySelectorAll("[name='criterio_nombre']");
      let criteriosValidos = true;
      criterios.forEach((criterio) => {
        if (criterio.value === null || criterio.value === "") {
          criteriosValidos = false;
        }
      });
      if (!criteriosValidos) {
        event.preventDefault();
        alert("Por favor, seleccione al menos un criterio válido.");
      }
    });

  // =====================================
  // Agregar un criterio al cargar la página
  // =====================================
  document.addEventListener("DOMContentLoaded", () => agregarCriterio());
</script>
{% endblock %}
